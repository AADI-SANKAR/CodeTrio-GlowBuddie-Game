<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Glow Buddies - Inclusive</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet" />
<style>
body { font-family: 'Quicksand', sans-serif; transition: background-color 0.5s ease; }
.grove-element {
  cursor: pointer; transition: transform 0.2s ease, box-shadow 0.3s ease;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; font-weight: bold; color: #000;
}
.grove-element:hover { transform: scale(1.05); }
.active-glow { box-shadow: 0 0 25px 10px var(--glow-color, #fff); transform: scale(1.1); }
.theme-light { --bg-color: #f0f9ff; }
.theme-dark { --bg-color: #0c1427; color: #fff; }
.bg-custom { background-color: var(--bg-color); }
</style>
</head>

<body id="body" class="theme-light bg-custom flex flex-col items-center justify-center min-h-screen">

<div class="text-center p-4">
<h1 class="text-4xl font-bold">Glow Buddies</h1>
<p class="mt-1 text-lg">🌈 Memory Game with Fun & Accessibility</p>

<div id="status" class="my-4 text-xl">Press Start to begin</div>
<button id="start" class="bg-blue-500 text-white px-4 py-2 rounded shadow">Start</button>

<div class="grid grid-cols-2 gap-4 max-w-sm mx-auto my-6">
  <div id="e1" data-id="1" class="grove-element rounded-full bg-yellow-300">A</div>
  <div id="e2" data-id="2" class="grove-element rounded-full bg-green-300">B</div>
  <div id="e3" data-id="3" class="grove-element rounded-full bg-pink-300">C</div>
  <div id="e4" data-id="4" class="grove-element rounded-full bg-purple-300">D</div>
</div>

<button id="theme" class="bg-gray-300 px-3 py-1 rounded">Switch Theme</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
<script>
const startBtn = document.getElementById('start');
const statusBox = document.getElementById('status');
const elements = document.querySelectorAll('.grove-element');
const themeBtn = document.getElementById('theme');
const body = document.getElementById('body');

let sequence = [], playerSeq = [], level = 0, stars = 0, playing = false;
const notes = ['C4','E4','G4','B4'];
const synths = notes.map(n => new Tone.Synth().toDestination());
const themes = [['🐱','🐶','🐰','🦊'],['🍎','🍌','🍇','🍊'],['🌞','🌛','⭐️','🌈']];
let themeIndex = 0;

function updateStatus(txt) {
  statusBox.textContent = `⭐ ${stars} | ${txt}`;
}

async function startGame() {
  level = 0; stars = 0; sequence = []; playing = true;
  startBtn.disabled = true;
  nextLevel();
}

function nextLevel() {
  level++; stars += 10; playerSeq = [];
  updateStatus(`Level ${level} - Your turn`);
  sequence.push(Math.floor(Math.random()*4)+1);
  playSeq();
}

async function playSeq() {
  playing = false;
  updateStatus(`Level ${level} - Watch`);
  for (let i of sequence) {
    await glow(i);
    await sleep(300);
  }
  playing = true;
}

function glow(id) {
  return new Promise(res => {
    const el = document.querySelector(`#e${id}`);
    el.classList.add('active-glow');
    synths[id-1].triggerAttackRelease(notes[id-1],'8n');
    setTimeout(() => { el.classList.remove('active-glow'); res(); }, 500);
  });
}

elements.forEach(el => el.addEventListener('click', e => {
  if (!playing) return;
  const id = parseInt(e.target.dataset.id);
  glow(id);
  playerSeq.push(id);
  if (playerSeq[playerSeq.length-1] !== sequence[playerSeq.length-1]) {
    gameOver();
    return;
  }
  if (playerSeq.length === sequence.length) {
    setTimeout(nextLevel, 500);
  }
}));

function gameOver() {
  updateStatus(`Game Over! Final ⭐: ${stars}`);
  startBtn.disabled = false;
  playing = false;
}

themeBtn.addEventListener('click', () => {
  themeIndex = (themeIndex+1)%themes.length;
  elements.forEach((el,i) => el.textContent = themes[themeIndex][i]);
  body.classList.toggle('theme-light');
  body.classList.toggle('theme-dark');
});

function sleep(ms) { return new Promise(r => setTimeout(r,ms)); }

startBtn.addEventListener('click', () => Tone.start().then(startGame));
</script>
</body>
</html>
